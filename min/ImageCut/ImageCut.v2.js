/**
 * ****************************************************
 * * @Class ImageCut
 * * @author Spell-Master (Omar Pautz)
 * * @copyright 2019
 * * @version 2.0 (2020)
 * ****************************************************
 * * Executa corte de imagens.
 * ****************************************************
 */
var ImageCut=function(t){var e,i,o,n,s=document.getElementById(t),d=!1,h=!1,a={ratio:1,left:0,top:0},r={imgLeft:0,imgTop:0,imgWidth:0,imgHeight:0,boxLeft:0,boxTop:0,posX:0,posY:0},g={boxWidth:0,boxHeight:0,imgWidth:0,imgHeight:0,left:0,top:0,right:0,bottom:0};function m(t){return Math.ceil("w"===t?s.offsetWidth:s.offsetHeight)}function f(t,e){a.left=-t*a.ratio,a.top=-e*a.ratio,o.style.top=-e+"px",o.style.left=-t+"px"}function c(t){var e;t.preventDefault(),t.stopPropagation(),e=t,r.boxLeft=i.offsetLeft,r.boxTop=i.offsetTop,r.posX=(e.clientX||e.pageX||e.touches&&e.touches[0].clientX)+window.scrollX,r.posY=(e.clientY||e.pageY||e.touches&&e.touches[0].clientY)+window.scrollY,document.addEventListener("mousemove",p),document.addEventListener("touchmove",p),document.addEventListener("mouseup",u),document.addEventListener("touchend",u)}function u(t){t.preventDefault(),document.removeEventListener("mouseup",u),document.removeEventListener("touchend",u),document.removeEventListener("mousemove",p),document.removeEventListener("touchmove",p)}function p(t){t.preventDefault(),t.stopPropagation(),r.imgLeft=(t.pageX||t.touches&&t.touches[0].pageX)-(r.posX-r.boxLeft),r.imgTop=(t.pageY||t.touches&&t.touches[0].pageY)-(r.posY-r.boxTop),r.imgWidth=i.offsetWidth+3,r.imgHeight=i.offsetHeight+3,r.imgLeft<0?r.imgLeft=1:r.imgLeft>o.offsetWidth-r.imgWidth&&(r.imgLeft=o.offsetWidth-r.imgWidth),r.imgTop<0?r.imgTop=1:r.imgTop>o.offsetHeight-r.imgHeight&&(r.imgTop=o.offsetHeight-r.imgHeight),f(r.imgLeft,r.imgTop),l(r.imgLeft,r.imgTop)}function l(t,e){i.style.top=e+100+"px",i.style.left=t+100+"px"}function v(t){t.preventDefault(),x(t.deltaY)}function x(t){if(d){if(g.boxWidth=Math.floor(i.clientWidth+t),g.boxHeight=Math.floor(i.clientHeight+t),g.imgWidth=o.clientWidth,g.imgHeight=o.clientHeight,g.boxWidth<50)return;if(g.boxWidth>g.imgWidth)return;if(g.left=i.offsetLeft-t/2,g.top=i.offsetTop-t/2,g.right=g.left+g.boxWidth,g.bottom=g.top+g.boxHeight,g.left<0&&(g.left=0),g.top<0&&(g.top=0),g.right>g.imgWidth)return;if(g.bottom>g.imgHeight)return;a.ratio=200/g.boxWidth,e=g.boxWidth,n=g.boxWidth,i.style.width=e+"px",i.style.height=n+"px",f(g.left,g.top),l(g.left,g.top),L()}var e,n}function L(){o.crossOrigin="anonymous",a.width=o.width*a.ratio,a.height=o.height*a.ratio,n.width=200,n.height=200,n.getContext("2d").drawImage(o,a.left,a.top,a.width,a.height)}function b(t){switch(t.preventDefault(),String.fromCharCode(t.charCode)){case"+":x(10);break;case"-":x(-10)}}void 0!==s||null!==s?(s.addEventListener("load",function(t){m("w")<210?console.warn("A imagem de corte deve possuir pelo menos 210 pixel's de largura"):m("h")<210?console.warn("A imagem de corte deve possuir pelo menos 210 pixel's de altura"):(d=!0,e=document.createElement("div"),i=document.createElement("div"),o=new Image,n=document.createElement("canvas"),h={w:m("w"),h:m("h")},s.classList.add("cut-focus"),s.draggable=!1,e.classList.add("cut-limiter"),e.setAttribute("style","max-width:"+h.w+"px; max-height:"+h.h+"px"),i.classList.add("cut-box"),o.src=s.src,o.draggable=!1,o.setAttribute("style","width:auto; height:auto; max-width:"+h.w+"px; max-height:"+h.h+"px"),s.parentNode.insertBefore(e,s.nextSibling),e.appendChild(i),i.appendChild(o),e.appendChild(s),f(m("w")/2-100,m("h")/2-100),i.addEventListener("mousedown",c,!1),i.addEventListener("touchstart",c,!1),i.addEventListener("wheel",v,!1),document.addEventListener("keypress",b,!1));var h},!1),this.sizePlus=function(){x(10)},this.sizeMinus=function(){x(-10)},this.setCut=function(){L(),$getImage=n.toDataURL("image/png",1),h=!0},this.getImage=function(){if(h)return $getImage}):console.error("Não foi possível identificar a imagem para corte")};